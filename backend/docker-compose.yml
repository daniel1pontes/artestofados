services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: estofados-backend
    environment:
      NODE_ENV: ${NODE_ENV:-production}
      PORT: ${PORT:-3001}
      DATABASE_URL: ${DATABASE_URL:-postgresql://artestofados:artestofados25@postgres:5432/estofados_db}
      JWT_SECRET: ${JWT_SECRET:-default-jwt-secret-key-must-be-at-least-32-characters-long-for-security}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-7d}
      WHATSAPP_SESSION_PATH: ${WHATSAPP_SESSION_PATH:-./whatsapp-sessions}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      GOOGLE_API_CREDENTIALS: ${GOOGLE_API_CREDENTIALS:-}
      FRONTEND_URL: ${FRONTEND_URL:-http://localhost:3000}
    ports:
      - "${PORT:-3001}:3001"
    volumes:
      - ./uploads:/app/uploads
      - ./whatsapp-sessions:/app/whatsapp-sessions
      - ../frontend/public/images/logo.png:/app/assets/images/logo.png:ro
    networks:
      - estofados-network
    restart: unless-stopped

networks:
  estofados-network:
    external: true

